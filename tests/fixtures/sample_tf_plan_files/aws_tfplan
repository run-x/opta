{"format_version": "0.2", "terraform_version": "1.0.10", "planned_values": {"outputs": {"docker_repo_url": {"sensitive": false, "value": ""}}, "root_module": {"child_modules": [{"resources": [{"address": "module.app.aws_iam_policy.k8s_service", "mode": "managed", "type": "aws_iam_policy", "name": "k8s_service", "provider_name": "registry.terraform.io/hashicorp/aws", "schema_version": 0, "values": {"arn": "arn:aws:iam::111111111111:policy/live-example-dev-http-service-app", "description": "", "id": "arn:aws:iam::111111111111:policy/live-example-dev-http-service-app", "name": "live-example-dev-http-service-app", "name_prefix": null, "path": "/", "policy": "{\"Statement\":[{\"Action\":[\"eks:DescribeCluster\"],\"Effect\":\"Allow\",\"Resource\":[\"*\"],\"Sid\":\"DescribeCluster\"}],\"Version\":\"2012-10-17\"}", "policy_id": "ANPAWPU6ND36OQ6DDZVOH", "tags": {"layer": "minecraft-demo", "opta": "true", "tf_address": "module.app.aws_iam_policy.k8s_service"}, "tags_all": {"layer": "minecraft-demo", "opta": "true", "tf_address": "module.app.aws_iam_policy.k8s_service"}}, "sensitive_values": {"tags": {}, "tags_all": {}}}, {"address": "module.app.aws_iam_role.k8s_service", "mode": "managed", "type": "aws_iam_role", "name": "k8s_service", "provider_name": "registry.terraform.io/hashicorp/aws", "schema_version": 0, "values": {"arn": "arn:aws:iam::111111111111:role/live-example-dev-http-service-app", "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"Federated\":\"arn:aws:iam::111111111111:oidc-provider/oidc.eks.us-east-1.amazonaws.com/id/D162A0C050BF994F46152B58A6823750\"},\"Action\":\"sts:AssumeRoleWithWebIdentity\",\"Condition\":{\"StringEquals\":{\"oidc.eks.us-east-1.amazonaws.com/id/D162A0C050BF994F46152B58A6823750:sub\":\"system:serviceaccount:http-service:app\"}}}]}", "create_date": "2021-12-01T17:55:45Z", "description": "", "force_detach_policies": false, "id": "live-example-dev-http-service-app", "inline_policy": [{"name": "", "policy": ""}], "managed_policy_arns": ["arn:aws:iam::111111111111:policy/live-example-dev-http-service-app"], "max_session_duration": 3600, "name": "live-example-dev-http-service-app", "name_prefix": "", "path": "/", "permissions_boundary": null, "tags": {"layer": "minecraft-demo", "opta": "true", "tf_address": "module.app.aws_iam_role.k8s_service"}, "tags_all": {"layer": "minecraft-demo", "opta": "true", "tf_address": "module.app.aws_iam_role.k8s_service"}, "unique_id": "AROAWPU6ND36JOITD7YGD"}, "sensitive_values": {"inline_policy": [{}], "managed_policy_arns": [false], "tags": {}, "tags_all": {}}}, {"address": "module.app.aws_iam_role_policy_attachment.vanilla_role_attachment", "mode": "managed", "type": "aws_iam_role_policy_attachment", "name": "vanilla_role_attachment", "provider_name": "registry.terraform.io/hashicorp/aws", "schema_version": 0, "values": {"id": "live-example-dev-http-service-app-20211201175547416800000001", "policy_arn": "arn:aws:iam::111111111111:policy/live-example-dev-http-service-app", "role": "live-example-dev-http-service-app"}, "sensitive_values": {}}, {"address": "module.app.helm_release.k8s-service", "mode": "managed", "type": "helm_release", "name": "k8s-service", "provider_name": "registry.terraform.io/hashicorp/helm", "schema_version": 0, "values": {"atomic": true, "chart": "../modules/aws_k8s_service/tf_module/../../opta-k8s-service-helm", "cleanup_on_fail": true, "create_namespace": false, "dependency_update": false, "description": null, "devel": null, "disable_crd_hooks": false, "disable_openapi_validation": false, "disable_webhooks": false, "force_update": false, "id": "http-service-app", "keyring": null, "lint": false, "manifest": null, "max_history": 0, "metadata": [{"app_version": "1.16.0", "chart": "k8s-service", "name": "http-service-app", "namespace": "default", "revision": 24, "values": "{\"autoscaling\":{\"maxReplicas\":\"2\",\"minReplicas\":\"2\",\"targetCPUUtilizationPercentage\":80,\"targetMemoryUtilizationPercentage\":80},\"consistentHash\":null,\"containerResourceLimits\":{\"cpu\":\"200m\",\"memory\":\"256Mi\"},\"containerResourceRequests\":{\"cpu\":\"100m\",\"memory\":\"128Mi\"},\"deployPods\":true,\"deployment_timestamp\":\"2022-02-01T23:26:47Z\",\"envVars\":[{\"name\":\"GUNICORN_CMD_ARGS\",\"value\":\"--bind=0.0.0.0:8000 --workers=3 --capture-output --error-logfile - --access-logfile - --access-logformat '%(h)s %(t)s %(r)s %(s)s Content-Type: %(i)s'\"}],\"environmentName\":\"live-example-dev\",\"healthcheck_path\":null,\"httpPort\":{\"name\":\"main\",\"port\":80,\"probeType\":\"http\",\"protocol\":null,\"servicePort\":80,\"tls\":false,\"type\":\"http\"},\"iamRoleArn\":\"arn:aws:iam::111111111111:role/live-example-dev-http-service-app\",\"image\":\"kennethreitz/httpbin\",\"ingressExtraAnnotations\":{},\"initialLivenessDelay\":30,\"initialReadinessDelay\":30,\"keepPathPrefix\":false,\"layerName\":\"http-service\",\"linkSecrets\":[],\"livenessProbePath\":\"/get\",\"moduleName\":\"app\",\"persistentStorage\":[],\"ports\":[{\"name\":\"main\",\"port\":80,\"probeType\":\"http\",\"protocol\":null,\"servicePort\":80,\"tls\":false,\"type\":\"http\"}],\"probePort\":{\"name\":\"main\",\"port\":80,\"probeType\":\"http\",\"protocol\":null,\"servicePort\":80,\"tls\":false,\"type\":\"http\"},\"readinessProbePath\":\"/get\",\"serviceAnnotations\":{},\"stickySession\":true,\"stickySessionMaxAge\":20,\"uriComponents\":[{\"domain\":\"baloney.runx.dev\",\"pathPrefix\":\"/hello\",\"pathPrefixName\":\"hello\"}],\"version\":\"latest\"}", "version": "0.1.0"}], "name": "http-service-app", "namespace": "default", "postrender": [], "recreate_pods": false, "render_subchart_notes": true, "replace": false, "repository": null, "repository_ca_file": null, "repository_cert_file": null, "repository_key_file": null, "repository_password": null, "repository_username": null, "reset_values": false, "reuse_values": false, "set": [], "set_sensitive": [], "skip_crds": false, "status": "deployed", "timeout": 300, "verify": false, "version": "0.1.0", "wait": true, "wait_for_jobs": false}, "sensitive_values": {"metadata": [{}], "postrender": [], "set": [], "set_sensitive": [], "values": []}}, {"address": "module.app.random_string.repo_name_hash", "mode": "managed", "type": "random_string", "name": "repo_name_hash", "provider_name": "registry.terraform.io/hashicorp/random", "schema_version": 1, "values": {"id": "5fap", "keepers": null, "length": 4, "lower": true, "min_lower": 0, "min_numeric": 0, "min_special": 0, "min_upper": 0, "number": true, "override_special": null, "result": "5fap", "special": false, "upper": false}, "sensitive_values": {}}], "address": "module.app"}]}}, "resource_changes": [{"address": "module.app.aws_iam_policy.k8s_service", "module_address": "module.app", "mode": "managed", "type": "aws_iam_policy", "name": "k8s_service", "provider_name": "registry.terraform.io/hashicorp/aws", "change": {"actions": ["no-op"], "before": {"arn": "arn:aws:iam::111111111111:policy/live-example-dev-http-service-app", "description": "", "id": "arn:aws:iam::111111111111:policy/live-example-dev-http-service-app", "name": "live-example-dev-http-service-app", "name_prefix": null, "path": "/", "policy": "{\"Statement\":[{\"Action\":[\"eks:DescribeCluster\"],\"Effect\":\"Allow\",\"Resource\":[\"*\"],\"Sid\":\"DescribeCluster\"}],\"Version\":\"2012-10-17\"}", "policy_id": "ANPAWPU6ND36OQ6DDZVOH", "tags": {"layer": "minecraft-demo", "opta": "true", "tf_address": "module.app.aws_iam_policy.k8s_service"}, "tags_all": {"layer": "minecraft-demo", "opta": "true", "tf_address": "module.app.aws_iam_policy.k8s_service"}}, "after": {"arn": "arn:aws:iam::111111111111:policy/live-example-dev-http-service-app", "description": "", "id": "arn:aws:iam::111111111111:policy/live-example-dev-http-service-app", "name": "live-example-dev-http-service-app", "name_prefix": null, "path": "/", "policy": "{\"Statement\":[{\"Action\":[\"eks:DescribeCluster\"],\"Effect\":\"Allow\",\"Resource\":[\"*\"],\"Sid\":\"DescribeCluster\"}],\"Version\":\"2012-10-17\"}", "policy_id": "ANPAWPU6ND36OQ6DDZVOH", "tags": {"layer": "minecraft-demo", "opta": "true", "tf_address": "module.app.aws_iam_policy.k8s_service"}, "tags_all": {"layer": "minecraft-demo", "opta": "true", "tf_address": "module.app.aws_iam_policy.k8s_service"}}, "after_unknown": {}, "before_sensitive": {"tags": {}, "tags_all": {}}, "after_sensitive": {"tags": {}, "tags_all": {}}}}, {"address": "module.app.aws_iam_role.k8s_service", "module_address": "module.app", "mode": "managed", "type": "aws_iam_role", "name": "k8s_service", "provider_name": "registry.terraform.io/hashicorp/aws", "change": {"actions": ["no-op"], "before": {"arn": "arn:aws:iam::111111111111:role/live-example-dev-http-service-app", "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"Federated\":\"arn:aws:iam::111111111111:oidc-provider/oidc.eks.us-east-1.amazonaws.com/id/D162A0C050BF994F46152B58A6823750\"},\"Action\":\"sts:AssumeRoleWithWebIdentity\",\"Condition\":{\"StringEquals\":{\"oidc.eks.us-east-1.amazonaws.com/id/D162A0C050BF994F46152B58A6823750:sub\":\"system:serviceaccount:http-service:app\"}}}]}", "create_date": "2021-12-01T17:55:45Z", "description": "", "force_detach_policies": false, "id": "live-example-dev-http-service-app", "inline_policy": [{"name": "", "policy": ""}], "managed_policy_arns": ["arn:aws:iam::111111111111:policy/live-example-dev-http-service-app"], "max_session_duration": 3600, "name": "live-example-dev-http-service-app", "name_prefix": "", "path": "/", "permissions_boundary": null, "tags": {"layer": "minecraft-demo", "opta": "true", "tf_address": "module.app.aws_iam_role.k8s_service"}, "tags_all": {"layer": "minecraft-demo", "opta": "true", "tf_address": "module.app.aws_iam_role.k8s_service"}, "unique_id": "AROAWPU6ND36JOITD7YGD"}, "after": {"arn": "arn:aws:iam::111111111111:role/live-example-dev-http-service-app", "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"Federated\":\"arn:aws:iam::111111111111:oidc-provider/oidc.eks.us-east-1.amazonaws.com/id/D162A0C050BF994F46152B58A6823750\"},\"Action\":\"sts:AssumeRoleWithWebIdentity\",\"Condition\":{\"StringEquals\":{\"oidc.eks.us-east-1.amazonaws.com/id/D162A0C050BF994F46152B58A6823750:sub\":\"system:serviceaccount:http-service:app\"}}}]}", "create_date": "2021-12-01T17:55:45Z", "description": "", "force_detach_policies": false, "id": "live-example-dev-http-service-app", "inline_policy": [{"name": "", "policy": ""}], "managed_policy_arns": ["arn:aws:iam::111111111111:policy/live-example-dev-http-service-app"], "max_session_duration": 3600, "name": "live-example-dev-http-service-app", "name_prefix": "", "path": "/", "permissions_boundary": null, "tags": {"layer": "minecraft-demo", "opta": "true", "tf_address": "module.app.aws_iam_role.k8s_service"}, "tags_all": {"layer": "minecraft-demo", "opta": "true", "tf_address": "module.app.aws_iam_role.k8s_service"}, "unique_id": "AROAWPU6ND36JOITD7YGD"}, "after_unknown": {}, "before_sensitive": {"inline_policy": [{}], "managed_policy_arns": [false], "tags": {}, "tags_all": {}}, "after_sensitive": {"inline_policy": [{}], "managed_policy_arns": [false], "tags": {}, "tags_all": {}}}}, {"address": "module.app.aws_iam_role_policy_attachment.vanilla_role_attachment", "module_address": "module.app", "mode": "managed", "type": "aws_iam_role_policy_attachment", "name": "vanilla_role_attachment", "provider_name": "registry.terraform.io/hashicorp/aws", "change": {"actions": ["no-op"], "before": {"id": "live-example-dev-http-service-app-20211201175547416800000001", "policy_arn": "arn:aws:iam::111111111111:policy/live-example-dev-http-service-app", "role": "live-example-dev-http-service-app"}, "after": {"id": "live-example-dev-http-service-app-20211201175547416800000001", "policy_arn": "arn:aws:iam::111111111111:policy/live-example-dev-http-service-app", "role": "live-example-dev-http-service-app"}, "after_unknown": {}, "before_sensitive": {}, "after_sensitive": {}}}, {"address": "module.app.helm_release.k8s-service", "module_address": "module.app", "mode": "managed", "type": "helm_release", "name": "k8s-service", "provider_name": "registry.terraform.io/hashicorp/helm", "change": {"actions": ["update"], "before": {"atomic": true, "chart": "../modules/aws_k8s_service/tf_module/../../opta-k8s-service-helm", "cleanup_on_fail": true, "create_namespace": false, "dependency_update": false, "description": null, "devel": null, "disable_crd_hooks": false, "disable_openapi_validation": false, "disable_webhooks": false, "force_update": false, "id": "http-service-app", "keyring": null, "lint": false, "manifest": null, "max_history": 0, "metadata": [{"app_version": "1.16.0", "chart": "k8s-service", "name": "http-service-app", "namespace": "default", "revision": 24, "values": "{\"autoscaling\":{\"maxReplicas\":\"2\",\"minReplicas\":\"2\",\"targetCPUUtilizationPercentage\":80,\"targetMemoryUtilizationPercentage\":80},\"consistentHash\":null,\"containerResourceLimits\":{\"cpu\":\"200m\",\"memory\":\"256Mi\"},\"containerResourceRequests\":{\"cpu\":\"100m\",\"memory\":\"128Mi\"},\"deployPods\":true,\"deployment_timestamp\":\"2022-02-01T23:26:47Z\",\"envVars\":[{\"name\":\"GUNICORN_CMD_ARGS\",\"value\":\"--bind=0.0.0.0:8000 --workers=3 --capture-output --error-logfile - --access-logfile - --access-logformat '%(h)s %(t)s %(r)s %(s)s Content-Type: %(i)s'\"}],\"environmentName\":\"live-example-dev\",\"healthcheck_path\":null,\"httpPort\":{\"name\":\"main\",\"port\":80,\"probeType\":\"http\",\"protocol\":null,\"servicePort\":80,\"tls\":false,\"type\":\"http\"},\"iamRoleArn\":\"arn:aws:iam::111111111111:role/live-example-dev-http-service-app\",\"image\":\"kennethreitz/httpbin\",\"ingressExtraAnnotations\":{},\"initialLivenessDelay\":30,\"initialReadinessDelay\":30,\"keepPathPrefix\":false,\"layerName\":\"http-service\",\"linkSecrets\":[],\"livenessProbePath\":\"/get\",\"moduleName\":\"app\",\"persistentStorage\":[],\"ports\":[{\"name\":\"main\",\"port\":80,\"probeType\":\"http\",\"protocol\":null,\"servicePort\":80,\"tls\":false,\"type\":\"http\"}],\"probePort\":{\"name\":\"main\",\"port\":80,\"probeType\":\"http\",\"protocol\":null,\"servicePort\":80,\"tls\":false,\"type\":\"http\"},\"readinessProbePath\":\"/get\",\"serviceAnnotations\":{},\"stickySession\":true,\"stickySessionMaxAge\":20,\"uriComponents\":[{\"domain\":\"baloney.runx.dev\",\"pathPrefix\":\"/hello\",\"pathPrefixName\":\"hello\"}],\"version\":\"latest\"}", "version": "0.1.0"}], "name": "http-service-app", "namespace": "default", "postrender": [], "recreate_pods": false, "render_subchart_notes": true, "replace": false, "repository": null, "repository_ca_file": null, "repository_cert_file": null, "repository_key_file": null, "repository_password": null, "repository_username": null, "reset_values": false, "reuse_values": false, "set": [], "set_sensitive": [], "skip_crds": false, "status": "deployed", "timeout": 300, "values": ["\"autoscaling\":\n  \"maxReplicas\": \"2\"\n  \"minReplicas\": \"2\"\n  \"targetCPUUtilizationPercentage\": 80\n  \"targetMemoryUtilizationPercentage\": 80\n\"consistentHash\": null\n\"containerResourceLimits\":\n  \"cpu\": \"200m\"\n  \"memory\": \"256Mi\"\n\"containerResourceRequests\":\n  \"cpu\": \"100m\"\n  \"memory\": \"128Mi\"\n\"deployPods\": true\n\"deployment_timestamp\": \"2022-02-01T23:26:47Z\"\n\"envVars\":\n- \"name\": \"GUNICORN_CMD_ARGS\"\n  \"value\": \"--bind=0.0.0.0:8000 --workers=3 --capture-output --error-logfile - --access-logfile\n    - --access-logformat '%(h)s %(t)s %(r)s %(s)s Content-Type: %(i)s'\"\n\"environmentName\": \"live-example-dev\"\n\"healthcheck_path\": null\n\"httpPort\":\n  \"name\": \"main\"\n  \"port\": 80\n  \"probeType\": \"http\"\n  \"protocol\": null\n  \"servicePort\": 80\n  \"tls\": false\n  \"type\": \"http\"\n\"iamRoleArn\": \"arn:aws:iam::111111111111:role/live-example-dev-http-service-app\"\n\"image\": \"kennethreitz/httpbin\"\n\"ingressExtraAnnotations\": {}\n\"initialLivenessDelay\": 30\n\"initialReadinessDelay\": 30\n\"keepPathPrefix\": false\n\"layerName\": \"http-service\"\n\"linkSecrets\": []\n\"livenessProbePath\": \"/get\"\n\"moduleName\": \"app\"\n\"persistentStorage\": []\n\"ports\":\n- \"name\": \"main\"\n  \"port\": 80\n  \"probeType\": \"http\"\n  \"protocol\": null\n  \"servicePort\": 80\n  \"tls\": false\n  \"type\": \"http\"\n\"probePort\":\n  \"name\": \"main\"\n  \"port\": 80\n  \"probeType\": \"http\"\n  \"protocol\": null\n  \"servicePort\": 80\n  \"tls\": false\n  \"type\": \"http\"\n\"readinessProbePath\": \"/get\"\n\"serviceAnnotations\": {}\n\"stickySession\": true\n\"stickySessionMaxAge\": 20\n\"uriComponents\":\n- \"domain\": \"baloney.runx.dev\"\n  \"pathPrefix\": \"/hello\"\n  \"pathPrefixName\": \"hello\"\n\"version\": \"latest\"\n"], "verify": false, "version": "0.1.0", "wait": true, "wait_for_jobs": false}, "after": {"atomic": true, "chart": "../modules/aws_k8s_service/tf_module/../../opta-k8s-service-helm", "cleanup_on_fail": true, "create_namespace": false, "dependency_update": false, "description": null, "devel": null, "disable_crd_hooks": false, "disable_openapi_validation": false, "disable_webhooks": false, "force_update": false, "id": "http-service-app", "keyring": null, "lint": false, "manifest": null, "max_history": 0, "metadata": [{"app_version": "1.16.0", "chart": "k8s-service", "name": "http-service-app", "namespace": "default", "revision": 24, "values": "{\"autoscaling\":{\"maxReplicas\":\"2\",\"minReplicas\":\"2\",\"targetCPUUtilizationPercentage\":80,\"targetMemoryUtilizationPercentage\":80},\"consistentHash\":null,\"containerResourceLimits\":{\"cpu\":\"200m\",\"memory\":\"256Mi\"},\"containerResourceRequests\":{\"cpu\":\"100m\",\"memory\":\"128Mi\"},\"deployPods\":true,\"deployment_timestamp\":\"2022-02-01T23:26:47Z\",\"envVars\":[{\"name\":\"GUNICORN_CMD_ARGS\",\"value\":\"--bind=0.0.0.0:8000 --workers=3 --capture-output --error-logfile - --access-logfile - --access-logformat '%(h)s %(t)s %(r)s %(s)s Content-Type: %(i)s'\"}],\"environmentName\":\"live-example-dev\",\"healthcheck_path\":null,\"httpPort\":{\"name\":\"main\",\"port\":80,\"probeType\":\"http\",\"protocol\":null,\"servicePort\":80,\"tls\":false,\"type\":\"http\"},\"iamRoleArn\":\"arn:aws:iam::111111111111:role/live-example-dev-http-service-app\",\"image\":\"kennethreitz/httpbin\",\"ingressExtraAnnotations\":{},\"initialLivenessDelay\":30,\"initialReadinessDelay\":30,\"keepPathPrefix\":false,\"layerName\":\"http-service\",\"linkSecrets\":[],\"livenessProbePath\":\"/get\",\"moduleName\":\"app\",\"persistentStorage\":[],\"ports\":[{\"name\":\"main\",\"port\":80,\"probeType\":\"http\",\"protocol\":null,\"servicePort\":80,\"tls\":false,\"type\":\"http\"}],\"probePort\":{\"name\":\"main\",\"port\":80,\"probeType\":\"http\",\"protocol\":null,\"servicePort\":80,\"tls\":false,\"type\":\"http\"},\"readinessProbePath\":\"/get\",\"serviceAnnotations\":{},\"stickySession\":true,\"stickySessionMaxAge\":20,\"uriComponents\":[{\"domain\":\"baloney.runx.dev\",\"pathPrefix\":\"/hello\",\"pathPrefixName\":\"hello\"}],\"version\":\"latest\"}", "version": "0.1.0"}], "name": "http-service-app", "namespace": "default", "postrender": [], "recreate_pods": false, "render_subchart_notes": true, "replace": false, "repository": null, "repository_ca_file": null, "repository_cert_file": null, "repository_key_file": null, "repository_password": null, "repository_username": null, "reset_values": false, "reuse_values": false, "set": [], "set_sensitive": [], "skip_crds": false, "status": "deployed", "timeout": 300, "verify": false, "version": "0.1.0", "wait": true, "wait_for_jobs": false}, "after_unknown": {"metadata": [{}], "postrender": [], "set": [], "set_sensitive": [], "values": true}, "before_sensitive": {"metadata": [{}], "postrender": [], "repository_password": true, "set": [], "set_sensitive": [], "values": [false]}, "after_sensitive": {"metadata": [{}], "postrender": [], "repository_password": true, "set": [], "set_sensitive": [], "values": []}}}, {"address": "module.app.random_string.repo_name_hash", "module_address": "module.app", "mode": "managed", "type": "random_string", "name": "repo_name_hash", "provider_name": "registry.terraform.io/hashicorp/random", "change": {"actions": ["no-op"], "before": {"id": "5fap", "keepers": null, "length": 4, "lower": true, "min_lower": 0, "min_numeric": 0, "min_special": 0, "min_upper": 0, "number": true, "override_special": null, "result": "5fap", "special": false, "upper": false}, "after": {"id": "5fap", "keepers": null, "length": 4, "lower": true, "min_lower": 0, "min_numeric": 0, "min_special": 0, "min_upper": 0, "number": true, "override_special": null, "result": "5fap", "special": false, "upper": false}, "after_unknown": {}, "before_sensitive": {}, "after_sensitive": {}}}], "output_changes": {"docker_repo_url": {"actions": ["no-op"], "before": "", "after": "", "after_unknown": false, "before_sensitive": false, "after_sensitive": false}}, "prior_state": {"format_version": "0.2", "terraform_version": "1.0.10", "values": {"outputs": {"docker_repo_url": {"sensitive": false, "value": ""}}, "root_module": {"resources": [{"address": "data.aws_caller_identity.provider", "mode": "data", "type": "aws_caller_identity", "name": "provider", "provider_name": "registry.terraform.io/hashicorp/aws", "schema_version": 0, "values": {"account_id": "111111111111", "arn": "arn:aws:sts::111111111111:assumed-role/AWSReservedSSO_AdministratorAccess_cb2fa8cb1f45950e/jd@runx.dev", "id": "111111111111", "user_id": "AROAWPU6ND36IXFHAFTEW:jd@runx.dev"}, "sensitive_values": {}}, {"address": "data.aws_eks_cluster_auth.k8s", "mode": "data", "type": "aws_eks_cluster_auth", "name": "k8s", "provider_name": "registry.terraform.io/hashicorp/aws", "schema_version": 0, "values": {"id": "opta-live-example-dev", "name": "opta-live-example-dev", "token": "k8s-aws-v1.aHR0cHM6Ly9zdHMuYW1hem9uYXdzLmNvbS8_QWN0aW9uPUdldENhbGxlcklkZW50aXR5JlZlcnNpb249MjAxMS0wNi0xNSZYLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFTSUFXUFU2TkQzNkkzSjRBUlVMJTJGMjAyMjAyMDElMkZ1cy1lYXN0LTElMkZzdHMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDIyMDIwMVQyMzQ1MDdaJlgtQW16LUV4cGlyZXM9MCZYLUFtei1TZWN1cml0eS1Ub2tlbj1JUW9KYjNKcFoybHVYMlZqRUJFYUNYVnpMWGRsYzNRdE1pSkdNRVFDSUgyZ3AwaFJxZzFYamNOTXZQM25BUTNvMkF3YnFKSCUyRkQxJTJCNld2STdSbWRqQWlBSmZHVkQ2blc5bmp3ZFA1OGJpb0N5SFVtZ0QwT3djdzc1SU8yVlVPNmxpeXFBQXdoS0VBRWFERFEwTlRrek5UQTJOamczTmlJTVVsd2xaJTJCaXdzM2hXMTZmbEt0MENoZW1HeHFrT3ZaUXpHSm41V3RUJTJGb2pETnJmSWM3ZnNJWWg3YnFqamdBMTB0dGo3VjhtSENjMXFCYWh2T1VlS3RXNXh3eGdxQ0d3MkUza3NleVczVWtiY3U4UGkzJTJGVXpuV05SMlNNOSUyRkIlMkZtbGVwTDNBUEl6Y1BldkxmQWJvODlXVEZoUUtIUVAwZjYxYmYzRGpuRkV1VmZDZEYzRnBtdVVYY05xMnZzbXk4NHgwUFhvNkR3WHFtTHFBR2RWeVBobHVOSyUyRkk4UUdISTIwNlFmakFQSlZoTlVNS2gyOWlzNmVKRyUyRjBmM2Z4c3lneSUyRm5PV1d0MlRma3BIMEY1M1c3MjRVdGdRbE9aJTJGcVBheXVkNm5ReWslMkZxeWJYYWdQUDVyT3pEMDMlMkJrdlF5QklBMDJidGtxU3VpVzlhYUtWbHltYWVZZXFra2lvZko2bnJzeFpYUiUyQkd3Wm5oWVIybiUyRjBUcEpEa3U3Ym1LbmRCRUIlMkZ4cnBSeFpLd0RHNGY0MVRyeFl1WTYwVlh5d0ZqRDBQRTY5VEZwcVBFSVdqU0MlMkY5NllWU3IyUGVyNWJmWEp4MXptWlBGeWJVdVVCRVlvUXQ5UjZuRTh1SkFUUVZza0ZXWWZ5b2pCRERrMGVXUEJqcW5BViUyQkI0U3BRV2xKbkRTV0VaRGtVSkNpMTdOYUExZiUyQnhMR0tVMVBRWEJVNkZabzE0VGtWbkJwNFpMdmVGa3JNd3VmdFFINWc3M3VqMm5SRFIzbDNPeVYyVXlPMU9EMGUlMkZ1WkVnUWVScVkzbG9OaXpMNSUyRiUyQmZYMDFGeVRvRXdrdHNldFQlMkJSeDBaaElUd0M1NSUyRjBCSUF4dGFjRHc5TWh4MnZFbG5DOXlMWG1sJTJGYVBqelI4dnZGaTVuTnZEV2FZV1Vrb1kyMCUyQmVTN3c4QWRDSVhiRnUwclpMancxZUx5WGxqRiZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QlM0J4LWs4cy1hd3MtaWQmWC1BbXotU2lnbmF0dXJlPTI5ZmZmNDA1MDcyYTdiNjQxNWFjZTBhNmQ1YzJmNDRmZDFhMThlNWM3NTdiYTg0YTA2YmFiZTgyZGQxNDQxNWM"}, "sensitive_values": {}}, {"address": "data.aws_region.provider", "mode": "data", "type": "aws_region", "name": "provider", "provider_name": "registry.terraform.io/hashicorp/aws", "schema_version": 0, "values": {"description": "US East (N. Virginia)", "endpoint": "ec2.us-east-1.amazonaws.com", "id": "us-east-1", "name": "us-east-1"}, "sensitive_values": {}}, {"address": "data.terraform_remote_state.parent", "mode": "data", "type": "terraform_remote_state", "name": "parent", "provider_name": "terraform.io/builtin/terraform", "schema_version": 0, "values": {"backend": "s3", "config": {"bucket": "opta-tf-state-runx-live-example-dev", "dynamodb_table": "opta-tf-state-runx-live-example-dev", "key": "live-example-dev", "region": "us-east-1"}, "defaults": null, "outputs": {"cert_arn": "arn:aws:acm:us-east-1:111111111111:certificate/2580a5f6-9c5a-43a5-bc0a-caf51699ae6d", "deployeruser_user_arn": "arn:aws:iam::111111111111:user/live-example-dev-live-example-dev-deployeruser", "docker_repo_url": "", "domain": "baloney.runx.dev", "k8s_ca_data": "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5RENDQWJDZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJeE1USXdNVEUzTWpVME5Gb1hEVE14TVRFeU9URTNNalUwTkZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTU14CjhCU0prdlBIZlhCUGg2WE4zNW1mcEdtY0dSMkp1cktNMUNadkxWQ1UySERQdTBXdHRZVTJhZ0FpcDVsN1JKc2IKaFo3b29qR3ROWmxIeERodlZyMENRcTE0YUpCbkdKdFdHMTR2Uk1UdGlGQ3JJZFRPY3VoSjU4WFJ3eGJITUxxVApVL3BJcG5WZDNkMDd5OWthTHJ0dlBlSFpycDYwTDlkUFhPYlhCQ2hDWlArSWtGSVJTbDBjSHNJZHBTZnFCZVhGClV2enY1bitjMjRkSGJQVFRDVVJGd1Y0ZTV2WjNKbk9NYVZtTm4waS8rZzllZ3NvYlRXcDdrVzhERGdGWnBLMEoKNFQzTll0TVFOdGI5RzZoa1hTS3BLWUR4SURCQ2N6Y0o5SU5yczEzVFYya1U2RXJJRzIyWlM3b2RjT0dQOER0UgpjUHZ5TmJIOVJ6bG1PZkVnaG4wQ0F3RUFBYU1qTUNFd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFEL1NEWjdtSzg0STJsdHQ1WmpFaWNRZGVRbjcKenFJbk5HMzFkUURrTi9SaE4rcUUxVXV0VlVwZzUwVEJsbGFSR2svQzVWUnBkNlBHV0NoaUhZUk9MRHhpYkl1UgpNakpZcFdwMWNLekNkOVE2cUlNRE9WRkE2cVlYVlpkRm9jZXd2MjZCOWJ2TTlBSHJBVFEzODQ2QzVrZVhhTmNHCjltaVlUVnliRm1lMkRnUnEzM2dDQWhMM3JlME1tSHBIeDFlMDN1b3hlSGZOcHdxWDJDZERhNTdCMEViOFlaSjIKNUUxd2dmWnJhSXNwN3dMTCtmSmh6eDFEOUdFZzV3dkExUHFxcTNTWUpxd1JINGlrNEtTMlNTQWRiMC9DU3JCegpEdm9BejlraEJ4QThwU0dRZWl5QVNDMkNaOGxYS1MwVklLa280KzVHMUxxUFR1WDdYRWV2cmxjczNqdz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=", "k8s_cluster_name": "opta-live-example-dev", "k8s_endpoint": "https://D162A0C050BF994F46152B58A6823750.gr7.us-east-1.eks.amazonaws.com", "k8s_node_group_security_id": "sg-08dbe466e111cda12", "k8s_openid_provider_arn": "arn:aws:iam::111111111111:oidc-provider/oidc.eks.us-east-1.amazonaws.com/id/D162A0C050BF994F46152B58A6823750", "k8s_openid_provider_url": "oidc.eks.us-east-1.amazonaws.com/id/D162A0C050BF994F46152B58A6823750", "kms_account_key_arn": "arn:aws:kms:us-east-1:111111111111:key/aaac2f57-1f39-405e-95fe-2cfbd24744d2", "kms_account_key_id": "aaac2f57-1f39-405e-95fe-2cfbd24744d2", "load_balancer_raw_dns": "opta-live-example-dev-lb-55c137e25a30cad7.elb.us-east-1.amazonaws.com", "name_servers": ["ns-115.awsdns-14.com", "ns-1482.awsdns-57.org", "ns-1731.awsdns-24.co.uk", "ns-689.awsdns-22.net"], "private_subnet_ids": ["subnet-031859ebf43a383bf", "subnet-0a6697022353e2818", "subnet-0949d6ab8a7f40f5a"], "public_nat_ips": ["54.156.73.82", "52.54.79.247", "44.195.146.148"], "public_subnets_ids": ["subnet-0f8905a97ac7f77c2", "subnet-0309370e9f868e916", "subnet-0a1b40b7cda091b53"], "role_arn": "arn:aws:iam::111111111111:role/live-example-dev-live-example-dev-deployerrole", "s3_log_bucket_id": "opta-live-example-dev-logging-bucket-459892b04159c344", "s3_log_bucket_name": "opta-live-example-dev-logging-bucket-459892b04159c344", "user_arn": "arn:aws:iam::111111111111:user/live-example-dev-live-example-dev-deployeruser", "vpc_id": "vpc-0872723d0b54b162e", "zone_id": "Z0590875IJFAYVYAZJ5G"}, "workspace": null}, "sensitive_values": {"config": {}, "outputs": {"name_servers": [false, false, false, false], "private_subnet_ids": [false, false, false], "public_nat_ips": [false, false, false], "public_subnets_ids": [false, false, false]}}}], "child_modules": [{"resources": [{"address": "module.app.aws_iam_policy.k8s_service", "mode": "managed", "type": "aws_iam_policy", "name": "k8s_service", "provider_name": "registry.terraform.io/hashicorp/aws", "schema_version": 0, "values": {"arn": "arn:aws:iam::111111111111:policy/live-example-dev-http-service-app", "description": "", "id": "arn:aws:iam::111111111111:policy/live-example-dev-http-service-app", "name": "live-example-dev-http-service-app", "name_prefix": null, "path": "/", "policy": "{\"Statement\":[{\"Action\":[\"eks:DescribeCluster\"],\"Effect\":\"Allow\",\"Resource\":[\"*\"],\"Sid\":\"DescribeCluster\"}],\"Version\":\"2012-10-17\"}", "policy_id": "ANPAWPU6ND36OQ6DDZVOH", "tags": {"layer": "minecraft-demo", "opta": "true", "tf_address": "module.app.aws_iam_policy.k8s_service"}, "tags_all": {"layer": "minecraft-demo", "opta": "true", "tf_address": "module.app.aws_iam_policy.k8s_service"}}, "sensitive_values": {"tags": {}, "tags_all": {}}}, {"address": "module.app.aws_iam_role.k8s_service", "mode": "managed", "type": "aws_iam_role", "name": "k8s_service", "provider_name": "registry.terraform.io/hashicorp/aws", "schema_version": 0, "values": {"arn": "arn:aws:iam::111111111111:role/live-example-dev-http-service-app", "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"Federated\":\"arn:aws:iam::111111111111:oidc-provider/oidc.eks.us-east-1.amazonaws.com/id/D162A0C050BF994F46152B58A6823750\"},\"Action\":\"sts:AssumeRoleWithWebIdentity\",\"Condition\":{\"StringEquals\":{\"oidc.eks.us-east-1.amazonaws.com/id/D162A0C050BF994F46152B58A6823750:sub\":\"system:serviceaccount:http-service:app\"}}}]}", "create_date": "2021-12-01T17:55:45Z", "description": "", "force_detach_policies": false, "id": "live-example-dev-http-service-app", "inline_policy": [{"name": "", "policy": ""}], "managed_policy_arns": ["arn:aws:iam::111111111111:policy/live-example-dev-http-service-app"], "max_session_duration": 3600, "name": "live-example-dev-http-service-app", "name_prefix": "", "path": "/", "permissions_boundary": null, "tags": {"layer": "minecraft-demo", "opta": "true", "tf_address": "module.app.aws_iam_role.k8s_service"}, "tags_all": {"layer": "minecraft-demo", "opta": "true", "tf_address": "module.app.aws_iam_role.k8s_service"}, "unique_id": "AROAWPU6ND36JOITD7YGD"}, "sensitive_values": {"inline_policy": [{}], "managed_policy_arns": [false], "tags": {}, "tags_all": {}}, "depends_on": ["module.app.data.aws_iam_policy_document.trust_k8s_openid", "data.terraform_remote_state.parent"]}, {"address": "module.app.aws_iam_role_policy_attachment.vanilla_role_attachment", "mode": "managed", "type": "aws_iam_role_policy_attachment", "name": "vanilla_role_attachment", "provider_name": "registry.terraform.io/hashicorp/aws", "schema_version": 0, "values": {"id": "live-example-dev-http-service-app-20211201175547416800000001", "policy_arn": "arn:aws:iam::111111111111:policy/live-example-dev-http-service-app", "role": "live-example-dev-http-service-app"}, "sensitive_values": {}, "depends_on": ["data.terraform_remote_state.parent", "module.app.aws_iam_policy.k8s_service", "module.app.aws_iam_role.k8s_service", "module.app.data.aws_iam_policy_document.trust_k8s_openid"]}, {"address": "module.app.data.aws_caller_identity.current", "mode": "data", "type": "aws_caller_identity", "name": "current", "provider_name": "registry.terraform.io/hashicorp/aws", "schema_version": 0, "values": {"account_id": "111111111111", "arn": "arn:aws:sts::111111111111:assumed-role/AWSReservedSSO_AdministratorAccess_cb2fa8cb1f45950e/jd@runx.dev", "id": "111111111111", "user_id": "AROAWPU6ND36IXFHAFTEW:jd@runx.dev"}, "sensitive_values": {}}, {"address": "module.app.data.aws_iam_policy_document.repo_policy", "mode": "data", "type": "aws_iam_policy_document", "name": "repo_policy", "provider_name": "registry.terraform.io/hashicorp/aws", "schema_version": 0, "values": {"id": "1245636253", "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"AllowAllFromAccount\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"ecr:*\",\n      \"Principal\": {\n        \"AWS\": \"arn:aws:iam::111111111111:root\"\n      }\n    }\n  ]\n}", "override_json": null, "override_policy_documents": null, "policy_id": null, "source_json": null, "source_policy_documents": null, "statement": [{"actions": ["ecr:*"], "condition": [], "effect": "Allow", "not_actions": [], "not_principals": [], "not_resources": [], "principals": [{"identifiers": ["arn:aws:iam::111111111111:root"], "type": "AWS"}], "resources": [], "sid": "AllowAllFromAccount"}], "version": "2012-10-17"}, "sensitive_values": {"statement": [{"actions": [false], "condition": [], "not_actions": [], "not_principals": [], "not_resources": [], "principals": [{"identifiers": [false]}], "resources": []}]}}, {"address": "module.app.data.aws_iam_policy_document.trust_k8s_openid", "mode": "data", "type": "aws_iam_policy_document", "name": "trust_k8s_openid", "provider_name": "registry.terraform.io/hashicorp/aws", "schema_version": 0, "values": {"id": "1513372944", "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRoleWithWebIdentity\",\n      \"Principal\": {\n        \"Federated\": \"arn:aws:iam::111111111111:oidc-provider/oidc.eks.us-east-1.amazonaws.com/id/D162A0C050BF994F46152B58A6823750\"\n      },\n      \"Condition\": {\n        \"StringEquals\": {\n          \"oidc.eks.us-east-1.amazonaws.com/id/D162A0C050BF994F46152B58A6823750:sub\": \"system:serviceaccount:http-service:app\"\n        }\n      }\n    }\n  ]\n}", "override_json": null, "override_policy_documents": null, "policy_id": null, "source_json": null, "source_policy_documents": null, "statement": [{"actions": ["sts:AssumeRoleWithWebIdentity"], "condition": [{"test": "StringEquals", "values": ["system:serviceaccount:http-service:app"], "variable": "oidc.eks.us-east-1.amazonaws.com/id/D162A0C050BF994F46152B58A6823750:sub"}], "effect": "Allow", "not_actions": [], "not_principals": [], "not_resources": [], "principals": [{"identifiers": ["arn:aws:iam::111111111111:oidc-provider/oidc.eks.us-east-1.amazonaws.com/id/D162A0C050BF994F46152B58A6823750"], "type": "Federated"}], "resources": [], "sid": ""}], "version": "2012-10-17"}, "sensitive_values": {"statement": [{"actions": [false], "condition": [{"values": [false]}], "not_actions": [], "not_principals": [], "not_resources": [], "principals": [{"identifiers": [false]}], "resources": []}]}}, {"address": "module.app.helm_release.k8s-service", "mode": "managed", "type": "helm_release", "name": "k8s-service", "provider_name": "registry.terraform.io/hashicorp/helm", "schema_version": 0, "values": {"atomic": true, "chart": "../modules/aws_k8s_service/tf_module/../../opta-k8s-service-helm", "cleanup_on_fail": true, "create_namespace": false, "dependency_update": false, "description": null, "devel": null, "disable_crd_hooks": false, "disable_openapi_validation": false, "disable_webhooks": false, "force_update": false, "id": "http-service-app", "keyring": null, "lint": false, "manifest": null, "max_history": 0, "metadata": [{"app_version": "1.16.0", "chart": "k8s-service", "name": "http-service-app", "namespace": "default", "revision": 24, "values": "{\"autoscaling\":{\"maxReplicas\":\"2\",\"minReplicas\":\"2\",\"targetCPUUtilizationPercentage\":80,\"targetMemoryUtilizationPercentage\":80},\"consistentHash\":null,\"containerResourceLimits\":{\"cpu\":\"200m\",\"memory\":\"256Mi\"},\"containerResourceRequests\":{\"cpu\":\"100m\",\"memory\":\"128Mi\"},\"deployPods\":true,\"deployment_timestamp\":\"2022-02-01T23:26:47Z\",\"envVars\":[{\"name\":\"GUNICORN_CMD_ARGS\",\"value\":\"--bind=0.0.0.0:8000 --workers=3 --capture-output --error-logfile - --access-logfile - --access-logformat '%(h)s %(t)s %(r)s %(s)s Content-Type: %(i)s'\"}],\"environmentName\":\"live-example-dev\",\"healthcheck_path\":null,\"httpPort\":{\"name\":\"main\",\"port\":80,\"probeType\":\"http\",\"protocol\":null,\"servicePort\":80,\"tls\":false,\"type\":\"http\"},\"iamRoleArn\":\"arn:aws:iam::111111111111:role/live-example-dev-http-service-app\",\"image\":\"kennethreitz/httpbin\",\"ingressExtraAnnotations\":{},\"initialLivenessDelay\":30,\"initialReadinessDelay\":30,\"keepPathPrefix\":false,\"layerName\":\"http-service\",\"linkSecrets\":[],\"livenessProbePath\":\"/get\",\"moduleName\":\"app\",\"persistentStorage\":[],\"ports\":[{\"name\":\"main\",\"port\":80,\"probeType\":\"http\",\"protocol\":null,\"servicePort\":80,\"tls\":false,\"type\":\"http\"}],\"probePort\":{\"name\":\"main\",\"port\":80,\"probeType\":\"http\",\"protocol\":null,\"servicePort\":80,\"tls\":false,\"type\":\"http\"},\"readinessProbePath\":\"/get\",\"serviceAnnotations\":{},\"stickySession\":true,\"stickySessionMaxAge\":20,\"uriComponents\":[{\"domain\":\"baloney.runx.dev\",\"pathPrefix\":\"/hello\",\"pathPrefixName\":\"hello\"}],\"version\":\"latest\"}", "version": "0.1.0"}], "name": "http-service-app", "namespace": "default", "postrender": [], "recreate_pods": false, "render_subchart_notes": true, "replace": false, "repository": null, "repository_ca_file": null, "repository_cert_file": null, "repository_key_file": null, "repository_password": null, "repository_username": null, "reset_values": false, "reuse_values": false, "set": [], "set_sensitive": [], "skip_crds": false, "status": "deployed", "timeout": 300, "values": ["\"autoscaling\":\n  \"maxReplicas\": \"2\"\n  \"minReplicas\": \"2\"\n  \"targetCPUUtilizationPercentage\": 80\n  \"targetMemoryUtilizationPercentage\": 80\n\"consistentHash\": null\n\"containerResourceLimits\":\n  \"cpu\": \"200m\"\n  \"memory\": \"256Mi\"\n\"containerResourceRequests\":\n  \"cpu\": \"100m\"\n  \"memory\": \"128Mi\"\n\"deployPods\": true\n\"deployment_timestamp\": \"2022-02-01T23:26:47Z\"\n\"envVars\":\n- \"name\": \"GUNICORN_CMD_ARGS\"\n  \"value\": \"--bind=0.0.0.0:8000 --workers=3 --capture-output --error-logfile - --access-logfile\n    - --access-logformat '%(h)s %(t)s %(r)s %(s)s Content-Type: %(i)s'\"\n\"environmentName\": \"live-example-dev\"\n\"healthcheck_path\": null\n\"httpPort\":\n  \"name\": \"main\"\n  \"port\": 80\n  \"probeType\": \"http\"\n  \"protocol\": null\n  \"servicePort\": 80\n  \"tls\": false\n  \"type\": \"http\"\n\"iamRoleArn\": \"arn:aws:iam::111111111111:role/live-example-dev-http-service-app\"\n\"image\": \"kennethreitz/httpbin\"\n\"ingressExtraAnnotations\": {}\n\"initialLivenessDelay\": 30\n\"initialReadinessDelay\": 30\n\"keepPathPrefix\": false\n\"layerName\": \"http-service\"\n\"linkSecrets\": []\n\"livenessProbePath\": \"/get\"\n\"moduleName\": \"app\"\n\"persistentStorage\": []\n\"ports\":\n- \"name\": \"main\"\n  \"port\": 80\n  \"probeType\": \"http\"\n  \"protocol\": null\n  \"servicePort\": 80\n  \"tls\": false\n  \"type\": \"http\"\n\"probePort\":\n  \"name\": \"main\"\n  \"port\": 80\n  \"probeType\": \"http\"\n  \"protocol\": null\n  \"servicePort\": 80\n  \"tls\": false\n  \"type\": \"http\"\n\"readinessProbePath\": \"/get\"\n\"serviceAnnotations\": {}\n\"stickySession\": true\n\"stickySessionMaxAge\": 20\n\"uriComponents\":\n- \"domain\": \"baloney.runx.dev\"\n  \"pathPrefix\": \"/hello\"\n  \"pathPrefixName\": \"hello\"\n\"version\": \"latest\"\n"], "verify": false, "version": "0.1.0", "wait": true, "wait_for_jobs": false}, "sensitive_values": {"metadata": [{}], "postrender": [], "set": [], "set_sensitive": [], "values": [false]}, "depends_on": ["data.aws_eks_cluster_auth.k8s", "data.terraform_remote_state.parent", "module.app.aws_ecr_repository.repo", "module.app.aws_iam_role.k8s_service", "module.app.data.aws_iam_policy_document.trust_k8s_openid", "module.app.random_string.repo_name_hash"]}, {"address": "module.app.random_string.repo_name_hash", "mode": "managed", "type": "random_string", "name": "repo_name_hash", "provider_name": "registry.terraform.io/hashicorp/random", "schema_version": 1, "values": {"id": "5fap", "keepers": null, "length": 4, "lower": true, "min_lower": 0, "min_numeric": 0, "min_special": 0, "min_upper": 0, "number": true, "override_special": null, "result": "5fap", "special": false, "upper": false}, "sensitive_values": {}}], "address": "module.app"}]}}}, "configuration": {"provider_config": {"aws": {"name": "aws", "version_constraint": "3.70.0", "expressions": {"allowed_account_ids": {"constant_value": ["111111111111"]}, "region": {"constant_value": "us-east-1"}}}, "helm": {"name": "helm", "version_constraint": "2.4.1", "expressions": {"kubernetes": [{"cluster_ca_certificate": {"constant_value": "${base64decode(data.terraform_remote_state.parent.outputs.k8s_ca_data)}", "references": ["data.terraform_remote_state.parent.outputs.k8s_ca_data", "data.terraform_remote_state.parent.outputs", "data.terraform_remote_state.parent"]}, "host": {"constant_value": "${data.terraform_remote_state.parent.outputs.k8s_endpoint}", "references": ["data.terraform_remote_state.parent.outputs.k8s_endpoint", "data.terraform_remote_state.parent.outputs", "data.terraform_remote_state.parent"]}, "token": {"constant_value": "${data.aws_eks_cluster_auth.k8s.token}", "references": ["data.aws_eks_cluster_auth.k8s.token", "data.aws_eks_cluster_auth.k8s"]}}]}}, "module.app:kubernetes": {"name": "kubernetes", "version_constraint": ">= 1.13.3", "module_address": "module.app"}}, "root_module": {"outputs": {"docker_repo_url": {"expression": {"constant_value": "${module.app.docker_repo_url }", "references": ["module.app.docker_repo_url", "module.app"]}}}, "resources": [{"address": "data.aws_caller_identity.provider", "mode": "data", "type": "aws_caller_identity", "name": "provider", "provider_config_key": "aws", "schema_version": 0}, {"address": "data.aws_eks_cluster_auth.k8s", "mode": "data", "type": "aws_eks_cluster_auth", "name": "k8s", "provider_config_key": "aws", "expressions": {"name": {"constant_value": "${data.terraform_remote_state.parent.outputs.k8s_cluster_name}", "references": ["data.terraform_remote_state.parent.outputs.k8s_cluster_name", "data.terraform_remote_state.parent.outputs", "data.terraform_remote_state.parent"]}}, "schema_version": 0}, {"address": "data.aws_region.provider", "mode": "data", "type": "aws_region", "name": "provider", "provider_config_key": "aws", "schema_version": 0}, {"address": "data.terraform_remote_state.parent", "mode": "data", "type": "terraform_remote_state", "name": "parent", "provider_config_key": "terraform", "expressions": {"backend": {"constant_value": "s3"}, "config": {"constant_value": {"bucket": "opta-tf-state-runx-live-example-dev", "dynamodb_table": "opta-tf-state-runx-live-example-dev", "key": "live-example-dev", "region": "us-east-1"}}}, "schema_version": 0}], "module_calls": {"app": {"source": "../modules/aws_k8s_service/tf_module", "expressions": {"additional_iam_policies": {"constant_value": []}, "autoscaling_target_cpu_percentage": {"constant_value": 80}, "autoscaling_target_mem_percentage": {"constant_value": 80}, "consistent_hash": {"constant_value": null}, "digest": {"constant_value": null}, "env_name": {"constant_value": "live-example-dev"}, "env_vars": {"constant_value": [{"name": "GUNICORN_CMD_ARGS", "value": "--bind=0.0.0.0:8000 --workers=3 --capture-output --error-logfile - --access-logfile - --access-logformat '%(h)s %(t)s %(r)s %(s)s Content-Type: %(i)s'"}]}, "healthcheck_path": {"constant_value": null}, "http_port": {"constant_value": {"name": "main", "port": 80, "probeType": "http", "protocol": null, "servicePort": 80, "tls": false, "type": "http"}}, "iam_policy": {"constant_value": {"Statement": [{"Action": ["eks:DescribeCluster"], "Effect": "Allow", "Resource": ["*"], "Sid": "DescribeCluster"}], "Version": "2012-10-17"}}, "image": {"constant_value": "kennethreitz/httpbin"}, "ingress_extra_annotations": {"constant_value": {}}, "initial_liveness_delay": {"constant_value": 30}, "initial_readiness_delay": {"constant_value": 30}, "keep_path_prefix": {"constant_value": false}, "layer_name": {"constant_value": "http-service"}, "link_secrets": {"constant_value": []}, "links": {"constant_value": []}, "liveness_probe_path": {"constant_value": "/get"}, "max_containers": {"constant_value": "2"}, "min_containers": {"constant_value": 2}, "module_name": {"constant_value": "app"}, "openid_provider_arn": {"constant_value": "${data.terraform_remote_state.parent.outputs.k8s_openid_provider_arn}", "references": ["data.terraform_remote_state.parent.outputs.k8s_openid_provider_arn", "data.terraform_remote_state.parent.outputs", "data.terraform_remote_state.parent"]}, "openid_provider_url": {"constant_value": "${data.terraform_remote_state.parent.outputs.k8s_openid_provider_url}", "references": ["data.terraform_remote_state.parent.outputs.k8s_openid_provider_url", "data.terraform_remote_state.parent.outputs", "data.terraform_remote_state.parent"]}, "persistent_storage": {"constant_value": []}, "ports": {"constant_value": [{"name": "main", "port": 80, "probeType": "http", "protocol": null, "servicePort": 80, "tls": false, "type": "http"}]}, "probe_port": {"constant_value": {"name": "main", "port": 80, "probeType": "http", "protocol": null, "servicePort": 80, "tls": false, "type": "http"}}, "public_uri": {"constant_value": ["${data.terraform_remote_state.parent.outputs.domain}/hello"], "references": ["data.terraform_remote_state.parent.outputs.domain", "data.terraform_remote_state.parent.outputs", "data.terraform_remote_state.parent"]}, "readiness_probe_path": {"constant_value": "/get"}, "resource_request": {"constant_value": {"cpu": 100, "memory": 128}}, "secrets": {"constant_value": []}, "service_annotations": {"constant_value": {}}, "sticky_session": {"constant_value": true}, "sticky_session_max_age": {"constant_value": 20}, "tag": {"constant_value": null}}, "module": {"outputs": {"docker_repo_url": {"expression": {"references": ["local.uppercase_image", "local.get_ecr_repo_url"]}}}, "resources": [{"address": "aws_ecr_lifecycle_policy.repo_policy", "mode": "managed", "type": "aws_ecr_lifecycle_policy", "name": "repo_policy", "provider_config_key": "app:aws", "expressions": {"policy": {"references": ["path.module"]}, "repository": {"references": ["aws_ecr_repository.repo[0].name", "aws_ecr_repository.repo[0]", "aws_ecr_repository.repo"]}}, "schema_version": 0, "count_expression": {"references": ["local.uppercase_image"]}}, {"address": "aws_ecr_repository.repo", "mode": "managed", "type": "aws_ecr_repository", "name": "repo", "provider_config_key": "app:aws", "expressions": {"name": {"references": ["var.layer_name", "var.module_name", "random_string.repo_name_hash.result", "random_string.repo_name_hash"]}, "tags": {"constant_value": {"layer": "minecraft-demo", "opta": "true", "terraform": "true", "tf_address": "module.app.aws_ecr_repository.repo"}}}, "schema_version": 0, "count_expression": {"references": ["local.uppercase_image"]}}, {"address": "aws_ecr_repository_policy.repo_policy", "mode": "managed", "type": "aws_ecr_repository_policy", "name": "repo_policy", "provider_config_key": "app:aws", "expressions": {"policy": {"references": ["data.aws_iam_policy_document.repo_policy.json", "data.aws_iam_policy_document.repo_policy"]}, "repository": {"references": ["aws_ecr_repository.repo[0].name", "aws_ecr_repository.repo[0]", "aws_ecr_repository.repo"]}}, "schema_version": 0, "count_expression": {"references": ["local.uppercase_image"]}}, {"address": "aws_iam_policy.k8s_service", "mode": "managed", "type": "aws_iam_policy", "name": "k8s_service", "provider_config_key": "app:aws", "expressions": {"name": {"references": ["var.env_name", "var.layer_name", "var.module_name"]}, "policy": {"references": ["var.iam_policy"]}, "tags": {"constant_value": {"layer": "minecraft-demo", "opta": "true", "tf_address": "module.app.aws_iam_policy.k8s_service"}}}, "schema_version": 0}, {"address": "aws_iam_role.k8s_service", "mode": "managed", "type": "aws_iam_role", "name": "k8s_service", "provider_config_key": "app:aws", "expressions": {"assume_role_policy": {"references": ["data.aws_iam_policy_document.trust_k8s_openid.json", "data.aws_iam_policy_document.trust_k8s_openid"]}, "name": {"references": ["var.env_name", "var.layer_name", "var.module_name"]}, "tags": {"constant_value": {"layer": "minecraft-demo", "opta": "true", "tf_address": "module.app.aws_iam_role.k8s_service"}}}, "schema_version": 0}, {"address": "aws_iam_role_policy_attachment.extra_policies_attachment", "mode": "managed", "type": "aws_iam_role_policy_attachment", "name": "extra_policies_attachment", "provider_config_key": "app:aws", "expressions": {"policy_arn": {"references": ["var.additional_iam_policies", "count.index"]}, "role": {"references": ["aws_iam_role.k8s_service.name", "aws_iam_role.k8s_service"]}}, "schema_version": 0, "count_expression": {"references": ["var.additional_iam_policies"]}}, {"address": "aws_iam_role_policy_attachment.vanilla_role_attachment", "mode": "managed", "type": "aws_iam_role_policy_attachment", "name": "vanilla_role_attachment", "provider_config_key": "app:aws", "expressions": {"policy_arn": {"references": ["aws_iam_policy.k8s_service.arn", "aws_iam_policy.k8s_service"]}, "role": {"references": ["aws_iam_role.k8s_service.name", "aws_iam_role.k8s_service"]}}, "schema_version": 0}, {"address": "helm_release.k8s-service", "mode": "managed", "type": "helm_release", "name": "k8s-service", "provider_config_key": "app:helm", "expressions": {"atomic": {"constant_value": true}, "chart": {"references": ["path.module"]}, "cleanup_on_fail": {"constant_value": true}, "name": {"references": ["var.layer_name", "var.module_name"]}, "values": {"references": ["var.min_containers", "var.max_containers", "var.autoscaling_target_cpu_percentage", "var.autoscaling_target_mem_percentage", "var.http_port", "var.probe_port", "var.ports", "var.service_annotations", "var.resource_request[\"cpu\"]", "var.resource_request", "var.resource_request[\"memory\"]", "var.resource_request", "var.resource_request[\"cpu\"]", "var.resource_request", "var.resource_request[\"memory\"]", "var.resource_request", "local.uppercase_image", "var.tag", "var.digest", "local.uppercase_image", "var.digest", "aws_ecr_repository.repo[0].repository_url", "aws_ecr_repository.repo[0]", "aws_ecr_repository.repo", "var.digest", "var.tag", "aws_ecr_repository.repo[0].repository_url", "aws_ecr_repository.repo[0]", "aws_ecr_repository.repo", "var.tag", "var.tag", "var.image", "var.image", "var.tag", "var.tag", "var.tag", "var.healthcheck_path", "var.liveness_probe_path", "var.liveness_probe_path", "var.healthcheck_path", "var.initial_liveness_delay", "var.healthcheck_path", "var.readiness_probe_path", "var.readiness_probe_path", "var.healthcheck_path", "var.initial_readiness_delay", "var.healthcheck_path", "var.env_vars", "var.link_secrets", "local.uri_components", "var.layer_name", "var.module_name", "var.env_name", "aws_iam_role.k8s_service.arn", "aws_iam_role.k8s_service", "var.sticky_session", "var.sticky_session_max_age", "var.consistent_hash", "var.keep_path_prefix", "var.persistent_storage", "var.ingress_extra_annotations"]}}, "schema_version": 0}, {"address": "random_string.repo_name_hash", "mode": "managed", "type": "random_string", "name": "repo_name_hash", "provider_config_key": "app:random", "expressions": {"length": {"constant_value": 4}, "special": {"constant_value": false}, "upper": {"constant_value": false}}, "schema_version": 1}, {"address": "data.aws_caller_identity.current", "mode": "data", "type": "aws_caller_identity", "name": "current", "provider_config_key": "app:aws", "schema_version": 0}, {"address": "data.aws_ecr_image.service_image", "mode": "data", "type": "aws_ecr_image", "name": "service_image", "provider_config_key": "app:aws", "expressions": {"image_digest": {"references": ["var.digest"]}, "image_tag": {"references": ["var.tag"]}, "repository_name": {"references": ["aws_ecr_repository.repo[0].name", "aws_ecr_repository.repo[0]", "aws_ecr_repository.repo"]}}, "schema_version": 0, "count_expression": {"references": ["local.uppercase_image", "var.tag", "var.tag"]}}, {"address": "data.aws_iam_policy_document.repo_policy", "mode": "data", "type": "aws_iam_policy_document", "name": "repo_policy", "provider_config_key": "app:aws", "expressions": {"statement": [{"actions": {"constant_value": ["ecr:*"]}, "principals": [{"identifiers": {"references": ["data.aws_caller_identity.current.account_id", "data.aws_caller_identity.current"]}, "type": {"constant_value": "AWS"}}], "sid": {"constant_value": "AllowAllFromAccount"}}]}, "schema_version": 0}, {"address": "data.aws_iam_policy_document.trust_k8s_openid", "mode": "data", "type": "aws_iam_policy_document", "name": "trust_k8s_openid", "provider_config_key": "app:aws", "expressions": {"statement": [{"actions": {"constant_value": ["sts:AssumeRoleWithWebIdentity"]}, "condition": [{"test": {"constant_value": "StringEquals"}, "values": {"references": ["var.layer_name", "var.module_name"]}, "variable": {"references": ["var.openid_provider_url"]}}], "effect": {"constant_value": "Allow"}, "principals": [{"identifiers": {"references": ["var.openid_provider_arn"]}, "type": {"constant_value": "Federated"}}]}]}, "schema_version": 0}], "variables": {"additional_iam_policies": {"default": []}, "autoscaling_target_cpu_percentage": {"default": 80, "description": "Percentage of requested cpu after which autoscaling kicks in"}, "autoscaling_target_mem_percentage": {"default": 80, "description": "Percentage of requested memory after which autoscaling kicks in"}, "consistent_hash": {"default": null}, "digest": {"default": null, "description": "Digest of image to be deployed"}, "domain": {"default": ""}, "env_name": {"description": "Env name"}, "env_vars": {"default": [], "description": "Environment variables to pass to the container"}, "healthcheck_path": {"default": null}, "http_port": {"default": null, "description": "The port that exposes an HTTP interface"}, "iam_policy": {}, "image": {"description": "External Image to be deployed"}, "ingress_extra_annotations": {"default": {}}, "initial_liveness_delay": {"default": 30}, "initial_readiness_delay": {"default": 30}, "keep_path_prefix": {"default": false}, "layer_name": {"description": "Layer name"}, "link_secrets": {"default": []}, "links": {"default": null}, "liveness_probe_path": {"default": null, "description": "Url path for liveness probe"}, "max_containers": {"default": "3", "description": "Max value for HPA autoscaling"}, "min_containers": {"default": "1", "description": "Min value for HPA autoscaling"}, "module_name": {"description": "Module name"}, "openid_provider_arn": {}, "openid_provider_url": {}, "persistent_storage": {"default": []}, "ports": {"description": "Ports to be exposed"}, "probe_port": {"default": null, "description": "The port that is used for health probes"}, "public_uri": {"default": []}, "readiness_probe_path": {"default": null, "description": "Url path for readiness probe"}, "resource_request": {"default": {"cpu": 100, "memory": 128}}, "secrets": {"default": null}, "service_annotations": {"default": {}, "description": "Annotations to add to the service resource"}, "sticky_session": {"default": false}, "sticky_session_max_age": {"default": 86400}, "tag": {"default": null, "description": "Tag of image to be deployed"}}}}}}}}
