environments:
  - name: gcp-staging
    path: "../environments/gcp-env.yml"
    variables:
      max_containers: 2
name: blah42
modules:
  - type: gcp-service-account
    explicit_name: "hello-world-blah"
    extra_project_iam_roles:
      - "roles/firebase.admin"
  - type: k8s-service
    image: kennethreitz/httpbin
    min_containers: 2
    max_containers: "{vars.max_containers}"
    liveness_probe_path: "/get"
    readiness_probe_path: "/get"
    port:
      http: 80
    public_uri: "test-service.{parent.domain}"
    healthcheck_path: "/healthcheck"
    env_vars:
      - name: APPENV
        value: "{env}"
      - name: CLOUD_PROVIDER
        value: gcp
    secrets:
      - FAKE_SECRET
    links:
      - pg
      - redis
      - bucket
    persistent_storage:
      - path: "/DESIRED/PATH1"
        size: 5 # 5 GB
      - path: "/DESIRED/PATH2"
        size: 10 # 10 GB
  - name: pg
    type: postgres
    safety: false
  - name: redis
    type: redis
  - name: bucket
    type: gcp-gcs
    bucket_name: "runx-test-service-bucket-{env}"
