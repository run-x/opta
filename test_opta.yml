# This opta config file is used when testing the opta command on the test-service.
# Whenever a new feature is added to opta, it should also be added here.
#
# The opta.yml file in the test-service repo should not change, to additionally test
# backwards compatability.
# **Only** update the opta.yml file in the test-service repo when we are intentionally adding
# a breaking change.
meta:
  envs:
    - parent: "git@github.com:run-x/runx-infra.git//staging/opta.yml?ref=main"
      variables: {}
    - parent: "git@github.com:run-x/runx-infra.git//production/opta.yml?ref=main"
      variables: {}
  name: test-service-runx
  variables:
    tag: ""
modules:
  - app:
      type: k8s-service
      target_port: 5000
      tag: "{tag}"
      liveness_probe_path: "/healthcheck"
      readiness_probe_path: "/healthcheck"
      write_buckets:
        - "runx-test-bucket-{env}"
      env_vars:
        - name: APPENV
          value: "{env}"
        - _link: rds
        - _link: doc_db
        - _link: redis
      secrets:
        - FAKE_SECRET
  - rds:
      type: aws-rds
  - doc_db:
      type: aws-documentdb
  - redis:
      type: aws-redis
  - bucket:
      type: aws-s3-bucket
      bucket_name: "runx-test-bucket-{env}"
