backends:
  google: 
    terraform:
      backend: 
        gcs:
          bucket: "opta_tf_state_{env_name}"
          prefix: "{child_name}"
    resource:
      google_storage_bucket:
        tf_state:
          name: "opta_tf_state_{env_name}"
          versioning:
            enabled: true
modules:
  init: 
    location: git@github.com:run-x/runxc-tf-modules.git//init
    variables:
      name: str
    outputs:
      gcp-network:
        export: true
      k8s-cluster:
        export: true
    providers:
      data:
        google_client_config:
          provider: {}
      provider:
        kubernetes:
          load_config_file: false
          host: "https://${data.terraform_remote_state.env.outputs.k8s-cluster.endpoint}"
          token: "${data.google_client_config.provider.access_token}"
          cluster_ca_certificate: "${base64decode(data.terraform_remote_state.env.outputs.k8s-cluster.master_auth[0].cluster_ca_certificate)}"
  k8s-service: 
    location: git@github.com:run-x/runxc-tf-modules.git//k8s-service
    variables:
      name: str
      namespace: optional
      target_port: number
      public_ip_name: optional
      replicas: optional
      image: optional
      env_vars: optional
  gcp-postgres: 
    location: git@github.com:run-x/runxc-tf-modules.git//gcp-postgres
    variables:
      name: str
      tier: str
      gcp-network: str
    outputs:
      db_user: str
      db_password: str
      db_host: str
      db_name: str
  k8s-secret:
    location: git@github.com:run-x/runxc-tf-modules.git//k8s-secret?ref=ankur/secrets
    variables:
      name: str
    outputs:
      value: str
