backends:
  google: 
    terraform:
      backend: 
        gcs:
          bucket: "opta_tf_state_jd_test_1"
          prefix: "{layer_name}"
base_macros:
  _init:
    blocks:
      - backend: disabled
        modules:
          - state-init:
              type: state-init
              bucket_name: @opta_tf_state_jd_test_1
      - backend: enabled
        modules:
          - compute-init:
              type: compute-init
modules:
  state-init:
    location: /Users/juandiegopalomino/runx/runxc-tf-modules/state-init
    variables:
      bucket_name: str
    outputs:
      state-bucket-name:
        export: true
    providers:
      data:
        google_client_config:
          provider: {}
  compute-init:
    location: /Users/juandiegopalomino/runx/runxc-tf-modules/compute-init
    variables:
      name: str
    outputs:
      gcp-network:
        export: true
      k8s-cluster:
        export: true
    providers:
      provider:
        helm:
          kubernetes:
            host: "https://${data.terraform_remote_state.parent.outputs.k8s-cluster.endpoint}"
            token: "${data.google_client_config.provider.access_token}"
            cluster_ca_certificate: "${base64decode(data.terraform_remote_state.parent.outputs.k8s-cluster.master_auth[0].cluster_ca_certificate)}"
        kubernetes:
          load_config_file: false
          host: "https://${data.terraform_remote_state.parent.outputs.k8s-cluster.endpoint}"
          token: "${data.google_client_config.provider.access_token}"
          cluster_ca_certificate: "${base64decode(data.terraform_remote_state.parent.outputs.k8s-cluster.master_auth[0].cluster_ca_certificate)}"
  k8s-service: 
    location: /Users/juandiegopalomino/runx/runxc-tf-modules/k8s-service
    variables:
      name: str
      namespace: optional
      target_port: optional
      replicas: optional
      image: optional
      tag: optional
      env_vars: optional
      autoscaling_cpu_percentage_threshold: optional
      autoscaling_mem_percentage_threshold: optional
      liveness_probe_path: optional
      readiness_probe_path: optional
      pod_resource_limits: optional
      pod_resource_requests: optional
  gcp-postgres: 
    location: git@github.com:run-x/runxc-tf-modules.git//gcp-postgres
    variables:
      name: str
      tier: str
      gcp-network: str
    outputs:
      db_user: str
      db_password: str
      db_host: str
      db_name: str
  k8s-secret:
    location: git@github.com:run-x/runxc-tf-modules.git//k8s-secret
    variables:
      name: str
    outputs:
      value: str
